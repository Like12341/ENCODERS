<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.4" />
<title>Utility-based Replication</title>
<style type="text/css">
/* Sans-serif font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
div#toctitle,
span#author, span#revnumber, span#revdate, span#revremark,
div#footer {
  font-family: Arial,Helvetica,sans-serif;
}

/* Serif font. */
div.sectionbody {
  font-family: Georgia,"Times New Roman",Times,serif;
}

/* Monospace font. */
tt {
  font-size: inherit;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  font-size: inherit;
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
}

div#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  div#footer-badges { display: none; }
}

div#toc {
  margin-bottom: 2.5em;
}

div#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes();}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Utility-based Replication</h1>
<span id="author">Sam Wood</span><br />
<span id="email"><tt>&lt;<a href="mailto:sam@suns-tech.com">sam@suns-tech.com</a>&gt;</tt></span><br />
<span id="revdate">James Mathewson <james@suns-tech.com></span>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>v1.0, 2014-03</p></div>
<div class="paragraph"><p>This document describes the Utility-based Replication system that is used
to replicate content.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This document was written in <em>asciidoc</em> format and can generate html
or latex output. Please install <tt>source-highlight</tt> for syntax highlighting.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">Overview</h2>
<div class="sectionbody">
<div class="paragraph"><p>The purpose of the utility replication branch is to provide a system that
supports intelligent replication policies and is flexible. Similar to how
the utility caching system frames the caching problem as a 0-1 knapsack
optimization problem, this system frames the replication problem as a 0-1
knapsack optimization problem.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_implementation">Implementation</h2>
<div class="sectionbody">
<div class="paragraph"><p>utility based replication does the following steps:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Any neighbor node changes or updates, any new data object inserted, or specified poll period, the
utility dissemination pipeline is called.
</p>
</li>
<li>
<p>
The pipeline differs from the caching pipeline, as it gives a utility not based only upon the data object, but upon
a data object &#8592;&#8594; potential destination node pair.
</p>
</li>
<li>
<p>
A udiss threshold is set, and any data object above this value is considered for replication.
</p>
</li>
<li>
<p>
A knapsack will take all considered data objects for replication to a node, and the estimated connection time to that node,
and consider how many data objects, estimated, can be sent, up to our maximum allowed tokens (default is 5).    The knapsack considers which data objects have the highest value (utility value/size), that can fit in the knapsack (bound by remaining expected contact time), up to the maximum number of free tokens.
</p>
</li>
<li>
<p>
Initially, every node has a limited token count.    Upon every success or failure, if a node is still a neighbor, a token is put back on the stack, and the utility pipeline is called for the same destination node.   Thus, if all 5 tokens are allocated, and we successfully send 1 data object, the returned token allows 1 more data object to be queued with the prior 4 data objects (and prioritized).    The tokens mearly sets an upper bound of how many data objects can be queued for replication at a time.
</p>
</li>
<li>
<p>
Since a batch of data objects are considered at once, based upon maximum token count and knapsack, the data objects are queued with other data objects in the priority queue.   Replication is considered low priority, thus, it should not interfere with higher priority attribute matches.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Self node does the extra steps:
1.  We measure every node connect/disconnect time, up to 200 data points, and average them.
2.  Measure how much data is transmitted, and how long it takes, for an average bytes/sec.    We cant measure how
long it takes to receive a file, but using block send, we can measure how long to transmit a file.
3.  We report in our node description, two parameters: average connection time in miliseconds, and average bytes/sec.
4.  If we never disconnect from a neighbor node, the connection is considered static, thus, all data objects can be, potentially, sent.
The reported connection time is 0ms (since the nodes are neighbors, this signifies, currently, they are always in contact).</p></div>
<div class="paragraph"><p>Neighbor node steps:
1.   Store information from our neighbor nodes, node description.   This information is <em>average connection time in miliseconds</em> and <em>average throughput</em>.</p></div>
<div class="paragraph"><p>Replication Events:
ReplicationManager handles Events slightly different.    Replication Manager has its own events, and translates system events into replication events.    Thus, events, such as notifyDeleteDataObject, notifyInsertedDataObject, notifyNodeChange, etc, are translated into replication events.    Thus, there is a 2 tier event system for replication.</p></div>
<div class="sect2">
<h3 id="_relevant_files">Relevant Files</h3>
<div class="paragraph"><p>The above files support Doxygen documentation, to generate the documentation,
install Doxygen &gt;= 1.8.5 and execute:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>cd ~/cbmen-encoders/haggle/
./configure --enable-docs
make docs</tt></pre>
</div></div>
<div class="paragraph"><p>The documentation can be found:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>~/cbmen-encoders/haggle/doc/api/hagglekernel/html/ReplicationManager*</tt></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">Configuration</h2>
<div class="sectionbody">
<div class="paragraph"><p>For a detailed description of each configuration parameter, please see</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>~/cbmen-encoders/src/hagglekernel/ReplicationManagerUtility.h</tt></pre>
</div></div>
<div class="paragraph"><p>An example Utility Replication configuration is:</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.4
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">&lt;ReplicationManager</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationManagerUtility"</span> <span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;ReplicationManagerUtility</span></span>
        <span style="color: #009900">enabled</span><span style="color: #990000">=</span><span style="color: #FF0000">"false"</span>
        <span style="color: #009900">max_repl_tokens</span><span style="color: #990000">=</span><span style="color: #FF0000">"1"</span>
        <span style="color: #009900">token_per_node</span><span style="color: #990000">=</span><span style="color: #FF0000">"false"</span>
        <span style="color: #009900">replication_cooldown_ms</span><span style="color: #990000">=</span><span style="color: #FF0000">"200"</span>
        <span style="color: #009900">run_self_test</span><span style="color: #990000">=</span><span style="color: #FF0000">"false"</span>
        <span style="color: #009900">forward_poll_period_ms</span><span style="color: #990000">=</span><span style="color: #FF0000">"10000"</span>
        <span style="color: #009900">compute_period_ms</span><span style="color: #990000">=</span><span style="color: #FF0000">"11000"</span>
        <span style="color: #009900">forward_on_node_change</span><span style="color: #990000">=</span><span style="color: #FF0000">"true"</span>
        <span style="color: #009900">forward_on_do_insert</span><span style="color: #990000">=</span><span style="color: #FF0000">"false"</span>
        <span style="color: #009900">knapsack_optimizer</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationKnapsackOptimizerGreedy"</span>
        <span style="color: #009900">global_optimizer</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationGlobalOptimizerFixedWeights"</span>
        <span style="color: #009900">utility_function</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityAggregateSum"</span> <span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;ReplicationGlobalOptimizerFixedWeights</span></span> <span style="color: #009900">min_utility_threshold</span><span style="color: #990000">=</span><span style="color: #FF0000">"0.31"</span> <span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;Factor</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityAggregateSum"</span> <span style="color: #009900">weight</span><span style="color: #990000">=</span><span style="color: #FF0000">"1.0"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;Factor</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityLocal"</span> <span style="color: #009900">weight</span><span style="color: #990000">=</span><span style="color: #FF0000">"0.11"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;Factor</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityWait"</span> <span style="color: #009900">weight</span><span style="color: #990000">=</span><span style="color: #FF0000">"0.1"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;Factor</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityAttribute"</span> <span style="color: #009900">weight</span><span style="color: #990000">=</span><span style="color: #FF0000">"0.59"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;Factor</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityNeighborhoodOtherSocial"</span> <span style="color: #009900">weight</span><span style="color: #990000">=</span><span style="color: #FF0000">"0.3"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;/ReplicationGlobalOptimizerFixedWeights&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;ReplicationKnapsackOptimizerGreedy</span></span> <span style="color: #009900">discrete_size</span><span style="color: #990000">=</span><span style="color: #FF0000">"350200"</span>  <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;ReplicationUtilityAggregateSum</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityAggregateSum"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;Factor</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityLocal"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                                <span style="font-weight: bold"><span style="color: #0000FF">&lt;ReplicationUtilityLocal</span></span> <span style="color: #009900">protect_local</span><span style="color: #990000">=</span><span style="color: #FF0000">"true"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/Factor&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;Factor</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityWait"</span> <span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                                <span style="font-weight: bold"><span style="color: #0000FF">&lt;ReplicationUtilityWait</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityWait"</span><span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/Factor&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;Factor</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityAttribute"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                                <span style="font-weight: bold"><span style="color: #0000FF">&lt;ReplicationUtilityAttribute</span></span> <span style="color: #009900">attribute_name</span><span style="color: #990000">=</span><span style="color: #FF0000">"Important"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/Factor&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;Factor</span></span> <span style="color: #009900">name</span><span style="color: #990000">=</span><span style="color: #FF0000">"ReplicationUtilityNeighborhoodOtherSocial"</span><span style="font-weight: bold"><span style="color: #0000FF">&gt;</span></span>
                                <span style="font-weight: bold"><span style="color: #0000FF">&lt;ReplicationUtilityNeighborhoodOtherSocial</span></span>
                                <span style="color: #009900">only_physical_neighbors</span><span style="color: #990000">=</span><span style="color: #FF0000">"false"</span>
                                <span style="color: #009900">exp_num_neighbor_group</span><span style="color: #990000">=</span><span style="color: #FF0000">"3"</span>
                                <span style="color: #009900">exclude_my_group</span><span style="color: #990000">=</span><span style="color: #FF0000">"true"</span>
                                <span style="color: #009900">max_group_count</span><span style="color: #990000">=</span><span style="color: #FF0000">"1"</span> <span style="font-weight: bold"><span style="color: #0000FF">/&gt;</span></span>
                        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/Factor&gt;</span></span>
                <span style="font-weight: bold"><span style="color: #0000FF">&lt;/ReplicationUtilityAggregateSum&gt;</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">&lt;/ReplicationManagerUtility&gt;</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">&lt;/ReplicationManager&gt;</span></span></tt></pre></div></div>
<div class="paragraph"><p>Here, data objects will have a utility of 0 for replication for the first</p></div>
<div class="paragraph"><p>The following <tt>ReplicationManagerUtility</tt> configuration options are supported:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<tt>enable</tt>
</dt>
<dd>
<p>
    Set to <tt>true</tt> to enable the <tt>ReplicationManagerUtility</tt>, <tt>false</tt> otherwise.
</p>
</dd>
<dt class="hdlist1">
<tt>run_self_test</tt>
</dt>
<dd>
<p>
    Set to true to enable internal verification.   This only tests individual components, not
the full functionality.    The results are output into the log.
</p>
</dd>
<dt class="hdlist1">
<tt>max_repl_tokens</tt>
</dt>
<dd>
<p>
     Sets the total number of tokens available for replication.   Default value is 5 tokens.
</p>
</dd>
<dt class="hdlist1">
<tt>replication_cooldown_ms</tt>
</dt>
<dd>
<p>
     Sets the minimum cooldown period between replications.    This can be adjusted to avoid flooding.
</p>
</dd>
<dt class="hdlist1">
<tt>compute_period_ms</tt>
</dt>
<dd>
<p>
     The minimum amount of time before allowing the udissemination pipeline to recalcuate new values.
</p>
</dd>
<dt class="hdlist1">
<tt>forward_on_node_change</tt>
</dt>
<dd>
<p>
     Boolean value to call the udissemination pipeline when a node change event occurs.
</p>
</dd>
<dt class="hdlist1">
<tt>token_per_node</tt>
</dt>
<dd>
<p>
     Boolean value on how to treat tokens.    If <em>true</em>, then <em>max_repl_tokens</em> are available per node.
If false, then <em>max_repl_tokens</em> are available total (regardless of number of nodes).
</p>
</dd>
<dt class="hdlist1">
<tt>forward_on_do_insert</tt>
</dt>
<dd>
<p>
     Boolean value to call the udissemination pipeline when a new data object is inserted.
</p>
</dd>
<dt class="hdlist1">
<tt>forward_poll_period_ms</tt>
</dt>
<dd>
<p>
     This sets the timer (in milliseconds), of how often to execute the replication utility code.   It should be noted, that the replication code will always be called upon a new data object (data object inserted) or a change in neighbor nodes (a new node seen, a node is no longer in our immediate 1-hop neighborhood, or a node change (such as updated contact times)).
</p>
</dd>
<dt class="hdlist1">
<tt>knapsack_optimizer</tt>
</dt>
<dd>
<p>
     Specify which knapsack optimizer, which will decide, based upon file size, utility value, and estimated amount of time to replicate, which data objects to prioritize.    Currently, there is only one knapsack, <tt>ReplicationKnapsackOptimizerGreedy</tt>, is supported.
</p>
</dd>
<dt class="hdlist1">
<tt>global_optimizer</tt>
</dt>
<dd>
<p>
    This option sets the global optimizer.   Currently, only <tt>ReplicationGlobalOptimizerFixedWeights</tt> is supported.
</p>
</dd>
<dt class="hdlist1">
<tt>utility_function</tt>
</dt>
<dd>
<p>
    Specifies the title of xml code which will be used in utility replication, and which ReplicationUtilityAggregate[Minimum, Sum, Maximum] will be used.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>The following 'ReplicationGlobalOptimizerFixedWeights` configurations options are supported.   This functions identically as CacheGlobalOptimizerFixedWeights, except instead of, if below a threshold and purging data objects (in caching), this threshold must be exceeded to be considered for replication.    All data objects above this threshold are passed to the knapsack, to optimize which DO&#8217;s are sent first.    Thus, it does not ensure replication, only that it will be considered for replication.</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<tt>min_utility_threshold</tt>
</dt>
<dd>
<p>
    The minimum utility value considered for replication.
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Within <tt>ReplicationGlobalOptimizerFixedWeights</tt>:
&lt;Factor name=[utility] weight="x"/&gt;    This gives each <em>utility</em> function a weight of <em>x</em>.   Valid utilities are:
    a. ReplicationUtilityAggregateMin
    b. ReplicationUtilityAggregateMax
    c. ReplicationUtilityAggregateSum
    d. ReplicationUtilityNOP
    e. ReplicationUtilityRandom
    f. ReplicationUtilityAttribute
    g. ReplicationUtilityWait
    h. ReplicationUtilityLocal
    i. ReplicationUtilityNeighborhoodOtherSocial</p></div>
<div class="paragraph"><p>The following ReplicationKnapsackOptimizerGreedy configuration options are supported:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<tt>discrete_size</tt>
</dt>
<dd>
<p>
    Specify a block size to be used for consideration of the knapsack.   It is calculated with the formula: discreteSize = CEIL(filesize/discrete_size).     The, if data object A has a size of 50k bytes, and data object B has a size of 20k bytes, and both have a utility value of <em>1</em> (where value is utility/discreteSize), then data object A will have a value of 1/50k and data object B will have a value of 1/20k.    If the discrete_size="50000", both data object A and B will have the same value value (1/1).   If the discrete_size="25000", then data object A will have a value of 1/2 (50k/25k = 2), and data object B will have a value of 1/1 = 1 (25k/25k = 1).
</p>
</dd>
</dl></div>
<div class="paragraph"><p>Under this dissemination implementation, the utility requires a node, as well as a data object.   This means, the data object does not have a single utility value, but has a utility value TO THAT NODE.
Thus, data object A may have a value of 0 to node n1, and a value of 1 to node n2.   For caching, there is no node but self.    For replication, the value is based upon the data object, potential node destination tuple.    The following utilities are supported.</p></div>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
ReplicationUtilityAggregateMin
</p>
</li>
<li>
<p>
ReplicationUtilityAggregateMax
</p>
</li>
<li>
<p>
ReplicationUtilityAggregateSum
</p>
</li>
<li>
<p>
ReplicationUtilityNOP
</p>
</li>
<li>
<p>
ReplicationUtilityRandom
</p>
</li>
<li>
<p>
ReplicationUtilityAttribute
</p>
</li>
<li>
<p>
ReplicationUtilityWait
</p>
</li>
<li>
<p>
ReplicationUtilityLocal
</p>
</li>
<li>
<p>
ReplicationUtilityNeighborhoodOtherSocial
</p>
</li>
</ol></div>
<div class="paragraph"><p>Under the utility function definitions, a new function, <tt>ReplicationUtilityWait</tt> has been defined.
The function is used to test replication functionality, by giving a value of <em>0</em>, until a specified amount of time has passed, in which case, it returns a <em>1</em>.   This is, functionally, 1-RelTTL, but to expedite verification and testing, a simple case was implemented.
The following options are supported for <tt>ReplicationUtilityWait</tt>:</p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
<tt>wait_s</tt>
</dt>
<dd>
<p>
   Specify, in seconds, how long this function should return zero.    After this time interval has expired, return a value of <em>1</em>.
</p>
</dd>
</dl></div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2014-05-29 17:31:19 PDT
</div>
</div>
</body>
</html>
